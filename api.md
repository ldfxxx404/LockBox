# API Документация

## Общая информация
**Базовый URL:** `/api`  
**Формат данных:** JSON  
**Аутентификация:** Использует сессии (`session`)

---

## 1. Аутентификация

### **1.1 Регистрация пользователя**
**Endpoint:** `POST /api/register`

**Описание:** Создает нового пользователя.

**Тело запроса (JSON):**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "name": "John Doe"
}
```

**Ответ (успех):**
```json
{
  "message": "Registration successful",
  "user": {
    "id": 1,
    "email": "user@example.com"
  }
}
```

**Ответ (ошибка):**
```json
{
  "error": "Email already exists"
}
```

---

### **1.2 Вход в систему**
**Endpoint:** `POST /api/login`

**Описание:** Аутентифицирует пользователя и создает сессию.

**Тело запроса (JSON):**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Ответ (успех):**
```json
{
  "message": "Login successful",
  "user": {
    "id": 1,
    "email": "user@example.com"
  }
}
```

**Ответ (ошибка):**
```json
{
  "error": "Invalid email or password"
}
```

---

### **1.3 Выход из системы**
**Endpoint:** `POST /api/logout`

**Описание:** Завершает сессию пользователя.

**Ответ:**
```json
{
  "message": "Logout successful"
}
```

---

## 2. Файловое хранилище

### **2.1 Загрузка файла**
**Endpoint:** `POST /api/upload`

**Описание:** Загружает файл в хранилище пользователя.

**Форма запроса (multipart/form-data):**
- `file`: Файл для загрузки

**Ответ (успех):**
```json
{
  "message": "File uploaded",
  "filename": "example.txt"
}
```

**Ответ (ошибка):**
```json
{
  "error": "Invalid file type"
}
```

---

### **2.2 Получение списка файлов и информации о хранилище**
**Endpoint:** `GET /api/storage`

**Описание:** Возвращает список файлов пользователя и текущий статус хранилища.

**Ответ:**
```json
{
  "files": ["file1.txt", "file2.jpg"],
  "storage": {
    "used": 5000,
    "limit": 10000
  }
}
```

---

### **2.3 Загрузка файла**
**Endpoint:** `GET /api/storage/{filename}`

**Описание:** Позволяет скачать файл пользователя.

**Пример запроса:**
```
GET /api/storage/example.txt
```

**Ответ:** Загружаемый файл.

---

### **2.4 Удаление файла**
**Endpoint:** `DELETE /api/delete/{filename}`

**Описание:** Удаляет файл из хранилища пользователя.

**Ответ (успех):**
```json
{
  "message": "File deleted"
}
```

**Ответ (ошибка):**
```json
{
  "error": "File not found"
}
```

---

## 3. Профиль пользователя

### **3.1 Получение информации о профиле**
**Endpoint:** `GET /api/profile`

**Описание:** Возвращает информацию о пользователе и его хранилище.

**Ответ:**
```json
{
  "user": {
    "id": 1,
    "email": "user@example.com",
    "name": "John Doe"
  },
  "storage": {
    "used": 5000,
    "limit": 10000
  }
}
```

---

## 4. Администрирование

### **4.1 Получение списка пользователей**
**Endpoint:** `GET /api/admin/users`

**Описание:** Возвращает список всех пользователей (только для админов).

**Ответ:**
```json
[
  { "id": 1, "email": "user1@example.com" },
  { "id": 2, "email": "user2@example.com" }
]
```

---

### **4.2 Обновление лимита хранилища**
**Endpoint:** `POST /api/admin/update_limit`

**Описание:** Обновляет лимит хранилища для пользователя (только для админов).

**Тело запроса:**
```json
{
  "user_id": 1,
  "new_limit": 20000
}
```

**Ответ (успех):**
```json
{
  "message": "Storage limit updated"
}
```

**Ответ (ошибка):**
```json
{
  "error": "Invalid user ID"
}
```

---

### **4.3 Назначение и отзыв администраторских прав**
**Endpoint:** `POST /api/admin/make_admin/{user_id}`

**Описание:** Назначает пользователя администратором (только для админов).

**Ответ (успех):**
```json
{
  "message": "User is now an admin"
}
```

**Endpoint:** `POST /api/admin/revoke_admin/{user_id}`

**Описание:** Лишает пользователя администраторских прав (только для админов).

**Ответ (успех):**
```json
{
  "message": "Admin rights revoked"
}
```

---

## Ошибки и коды ответа

| Код | Описание |
|------|-------------|
| 200  | Успешный запрос |
| 400  | Ошибка клиента (неверный запрос) |
| 401  | Неавторизованный доступ |
| 403  | Доступ запрещен (только для админов) |
| 404  | Файл или ресурс не найден |
| 500  | Ошибка сервера |

---

**Авторизация** требуется для всех запросов, кроме `/register` и `/login`.

